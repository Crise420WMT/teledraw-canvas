<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>Teledraw Canvas Example</title>
	<style type="text/css">
		html, body {
			background: #888;
		}
		
		canvas {
			background-color: white;
		}
		
	</style>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
	<script type="text/javascript" src="jquery.mousewheel.js"></script>
	<script type="text/javascript" src="teledraw-canvas.js"></script>
	<script type="text/javascript">
		var c;
		$(function () {
		
			var grid = createGrid(2048, 512);
			c = new TeledrawCanvas('#test-canvas', {
				fullWidth: 1024*2,
				fullHeight: 1024*2
			});
			c.on('display.update:after', function () {
				// draw gridlines
				var scanv = this.canvas();
				var off = this.state.currentOffset;
				var zoom = this.state.currentZoom;
				var dctx = $('#test-canvas').get(0).getContext('2d');
				if (grid) {
					var dw = dctx.canvas.width,
						dh = dctx.canvas.height,
						sw = dw / zoom,
						sh = dh / zoom;
					dctx.save();
					dctx.globalAlpha = 0.5;
					dctx.drawImage(grid, off.x, off.y, sw, sh, 0, 0, dw, dh);
					dctx.restore();
				}
			});
			c.on('zoom', function (newZoom) {
				grid = createGrid(2048, 512, newZoom);
			});
			var previewctx = $('#preview-canvas').get(0).getContext('2d');
			c.on('tool.end', function () {
				previewctx.clearRect(0,0,previewctx.canvas.width, previewctx.canvas.height);
				previewctx.drawImage(this.canvas(), 0, 0, previewctx.canvas.width, previewctx.canvas.height);
				if (grid) previewctx.drawImage(createGrid(2048, 512, 0.2), 0, 0, previewctx.canvas.width, previewctx.canvas.height);
			});
			c.zoom(0);
			function createGrid(fullSize, tileSize, zoom) {
				var grid = $('<canvas>').attr({width: fullSize, height: fullSize}).get(0);
				var ctx = grid.getContext('2d');
				var t = fullSize/tileSize; // how big the grid is on each side, number of tiles
				if (t > 1) {
					ctx.lineWidth = Math.ceil(3/zoom);
					ctx.strokeStyle="#aaa";
					for (var i = 1; i < t; ++i) {
						ctx.moveTo(i*tileSize, 0);
						ctx.lineTo(i*tileSize, fullSize);
						ctx.moveTo(0, i*tileSize);
						ctx.lineTo(fullSize, i*tileSize);
						ctx.stroke();
					}
					return grid;
				}
				return null;
			}
			
			$('#container').bind('mousewheel', function (e, d, dx, dy) {
				c.pan(-dx*10, dy*10);
				e.preventDefault();
			});
		});
	</script>

</head>
<body>
	<h1>Teledraw Canvas Example</h1>
	<div id="container">
		<canvas id="test-canvas" width="512" height="512">Oh crap... your browser doesn't support canvas!</canvas>
	</div>
	<button onclick="c.setTool('pencil')">pencil</button>
	<button onclick="c.setTool('eraser')">eraser</button>
	<button onclick="c.setTool('grab')">pan</button>
	<button onclick="c.setTool('pencil').setColor('#000')">black</button>
	<button onclick="c.setTool('pencil').setColor('rgb(255,0,0)')">red</button>
	<button onclick="c.setTool('pencil').setColor('hsl(240,100%,50%)')">blue</button>
	<button onclick="c.setTool('pencil').setColor('#00bb00')">green</button>
	<button onclick="c.setTool('pencil').setColor('yellow')">yellow</button>
	<button onclick="c.setStrokeSize(c.state.strokeSize+1000)">bigger</button>
	<button onclick="c.setStrokeSize(c.state.strokeSize-1000)">smaller</button>
	<button onclick="c.clear()">clear</button>
	<button onclick="c.undo()">undo</button>
	<button onclick="c.redo()">redo</button>
	<button onclick="c.zoom(c.state.currentZoom*2)">zoom (+)</button>
	<button onclick="c.zoom(c.state.currentZoom/2)">zoom (-)</button>
	<canvas id="preview-canvas" width="128" height="128"></canvas>
</body>
</html>
